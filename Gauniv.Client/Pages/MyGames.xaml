<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Gauniv.Client.ViewModel"
             xmlns:dto="clr-namespace:Gauniv.Client.Dtos"
             x:Class="Gauniv.Client.Pages.MyGames"
             Title="Ma Bibliothèque"
             x:DataType="vm:MyGamesViewModel"
             BackgroundColor="#1b2838">

    <Grid RowDefinitions="Auto,Auto,*">
        
        <!-- Header -->
        <Grid Grid.Row="0" 
              Padding="20,15"
              BackgroundColor="#171a21">
            <Label Text="Ma Bibliothèque"
                   FontSize="28"
                   FontAttributes="Bold"
                   TextColor="#c7d5e0"/>
        </Grid>

        <!-- Status message -->
        <Label Grid.Row="1"
               Text="{Binding StatusMessage}"
               TextColor="#8f98a0"
               FontSize="13"
               Padding="20,10"
               IsVisible="{Binding StatusMessage, Converter={StaticResource IsNotNullConverter}}"/>

        <!-- Loading -->
        <ActivityIndicator Grid.Row="2"
                          IsRunning="{Binding IsLoading}"
                          IsVisible="{Binding IsLoading}"
                          Color="#66c0f4"
                          HeightRequest="60"/>

        <!-- Liste des jeux possédés -->
        <ScrollView Grid.Row="2" IsVisible="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}">
            <CollectionView ItemsSource="{Binding Games}"
                           SelectionMode="None"
                           Margin="15,10">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="12"/>
                </CollectionView.ItemsLayout>
                
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="dto:GameDto">
                        <Frame Padding="0"
                               CornerRadius="4"
                               HasShadow="False"
                               BorderColor="Transparent"
                               BackgroundColor="#16202d">
                            
                            <Grid ColumnDefinitions="200,*" Padding="0">
                                
                                <!-- Image placeholder -->
                                <Frame Grid.Column="0"
                                      Padding="0"
                                      CornerRadius="0"
                                      HasShadow="False"
                                      BackgroundColor="#2a475e"
                                      BorderColor="Transparent"
                                      HeightRequest="100">
                                    <Image Source="{Binding ImageUrl}"
                                          Aspect="AspectFill"
                                          HorizontalOptions="Fill"
                                          VerticalOptions="Fill"/>
                                </Frame>
                                
                                <!-- Info du jeu -->
                                <Grid Grid.Column="1" 
                                     RowDefinitions="Auto,*,Auto"
                                     Padding="15,10">
                                    
                                    <!-- Titre -->
                                    <Label Grid.Row="0"
                                          Text="{Binding Title}"
                                          FontSize="18"
                                          FontAttributes="Bold"
                                          TextColor="#c7d5e0"
                                          Margin="0,0,0,5"/>
                                    
                                    <!-- Description -->
                                    <Label Grid.Row="1"
                                          Text="{Binding Description}"
                                          FontSize="13"
                                          TextColor="#8f98a0"
                                          LineBreakMode="WordWrap"
                                          MaxLines="2"
                                          Margin="0,0,0,10"/>
                                    
                                    <!-- Catégories et bouton -->
                                    <Grid Grid.Row="2" ColumnDefinitions="*,Auto">
                                        <!-- Catégories -->
                                        <FlexLayout Grid.Column="0"
                                                   BindableLayout.ItemsSource="{Binding Categories}"
                                                   Wrap="Wrap"
                                                   AlignItems="Center">
                                            <BindableLayout.ItemTemplate>
                                                <DataTemplate x:DataType="x:String">
                                                    <Frame Padding="6,3"
                                                          Margin="0,0,5,0"
                                                          CornerRadius="2"
                                                          HasShadow="False"
                                                          BackgroundColor="#1b2838"
                                                          BorderColor="Transparent">
                                                        <Label Text="{Binding .}"
                                                              FontSize="11"
                                                              TextColor="#66c0f4"/>
                                                    </Frame>
                                                </DataTemplate>
                                            </BindableLayout.ItemTemplate>
                                        </FlexLayout>
                                        
                                        <!-- Bouton Télécharger -->
                                        <Button Grid.Column="1"
                                               Text="Télécharger"
                                               Command="{Binding Source={RelativeSource AncestorType={x:Type vm:MyGamesViewModel}}, Path=DownloadGameCommand}"
                                               CommandParameter="{Binding .}"
                                               BackgroundColor="#5c7e10"
                                               TextColor="White"
                                               FontSize="14"
                                               Padding="20,8"
                                               CornerRadius="3"
                                               VerticalOptions="Center"/>
                                    </Grid>
                                </Grid>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </ScrollView>
    </Grid>
</ContentPage>