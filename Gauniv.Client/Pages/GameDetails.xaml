<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Gauniv.Client.ViewModel"
             x:Class="Gauniv.Client.Pages.GameDetails"
             Title="DÃ©tails du jeu"
             x:DataType="vm:GameDetailsViewModel"
             BackgroundColor="#1b2838"
             Shell.NavBarIsVisible="True">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="â† Retour" 
                     Command="{Binding GoBackCommand}"/>
    </ContentPage.ToolbarItems>

    <ScrollView>
        <VerticalStackLayout Padding="0" Spacing="0">
            
            <!-- Loading Indicator -->
            <ActivityIndicator IsRunning="{Binding IsLoading}"
                              IsVisible="{Binding IsLoading}"
                              Color="#66c0f4"
                              HeightRequest="100"
                              VerticalOptions="Center"
                              Margin="0,50,0,0"/>

            <!-- Game Content -->
            <VerticalStackLayout Spacing="0" IsVisible="{Binding Game, Converter={StaticResource IsNotNullConverter}}">
                
                <!-- Hero Image -->
                <Frame Padding="0"
                       CornerRadius="0"
                       HasShadow="False"
                       BackgroundColor="#2a475e"
                       BorderColor="Transparent"
                       HeightRequest="250"
                       Margin="0">
                    <Image Source="{Binding Game.ImageUrl}"
                          Aspect="AspectFill"
                          HorizontalOptions="Fill"
                          VerticalOptions="Fill"/>
                </Frame>

                <!-- Content -->
                <VerticalStackLayout Spacing="20" Padding="20" BackgroundColor="#1b2838">
                    
                    <!-- Header -->
                    <VerticalStackLayout Spacing="10">
                        <Label Text="{Binding Game.Title}"
                               FontSize="32"
                               FontAttributes="Bold"
                               TextColor="#c7d5e0"/>
                        
                        <Label Text="{Binding StatusMessage}"
                               FontSize="14"
                               TextColor="#8f98a0"
                               IsVisible="{Binding StatusMessage, Converter={StaticResource IsNotNullConverter}}"/>
                    </VerticalStackLayout>

                    <!-- Categories -->
                    <FlexLayout BindableLayout.ItemsSource="{Binding Game.Categories}"
                               Wrap="Wrap"
                               JustifyContent="Start">
                        <BindableLayout.ItemTemplate>
                            <DataTemplate x:DataType="x:String">
                                <Frame Padding="10,5"
                                       Margin="0,0,8,8"
                                       CornerRadius="3"
                                       HasShadow="False"
                                       BackgroundColor="#16202d"
                                       BorderColor="Transparent">
                                    <Label Text="{Binding .}"
                                           FontSize="13"
                                           TextColor="#66c0f4"/>
                                </Frame>
                            </DataTemplate>
                        </BindableLayout.ItemTemplate>
                    </FlexLayout>

                    <!-- Description -->
                    <Frame Padding="20"
                           CornerRadius="4"
                           HasShadow="False"
                           BackgroundColor="#16202d"
                           BorderColor="Transparent">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="Description"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="#c7d5e0"/>
                            <Label Text="{Binding Game.Description}"
                                   FontSize="14"
                                   TextColor="#8f98a0"
                                   LineBreakMode="WordWrap"/>
                        </VerticalStackLayout>
                    </Frame>

                    <Frame Padding="20"
                           CornerRadius="4"
                           HasShadow="False"
                           BackgroundColor="#16202d"
                           BorderColor="Transparent">
                        <Frame.Triggers>
                            <DataTrigger TargetType="Frame" Binding="{Binding IsOwned}" Value="True">
                                <Setter Property="IsVisible" Value="False"/>
                            </DataTrigger>
                            <DataTrigger TargetType="Frame" Binding="{Binding IsNotAdmin}" Value="False">
                                <Setter Property="IsVisible" Value="False"/>
                            </DataTrigger>
                        </Frame.Triggers>
                        <VerticalStackLayout Spacing="15">
                            <Label Text="{Binding Game.Price, StringFormat='Prix: {0:C}'}"
                                   FontSize="24"
                                   FontAttributes="Bold"
                                   TextColor="#beee11"/>
                            
                            <Button Text="Acheter ce jeu"
                                    Command="{Binding PurchaseCommand}"
                                    BackgroundColor="#5c7e10"
                                    TextColor="White"
                                    FontAttributes="Bold"
                                    FontSize="16"
                                    CornerRadius="3"
                                    HeightRequest="50"/>
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Owned Section -->
                    <Frame Padding="20"
                           CornerRadius="4"
                           HasShadow="False"
                           BackgroundColor="#16202d"
                           BorderColor="Transparent">
                        <Frame.Triggers>
                            <DataTrigger TargetType="Frame" Binding="{Binding IsOwned}" Value="False">
                                <Setter Property="IsVisible" Value="False"/>
                            </DataTrigger>
                            <DataTrigger TargetType="Frame" Binding="{Binding IsNotAdmin}" Value="False">
                                <Setter Property="IsVisible" Value="False"/>
                            </DataTrigger>
                        </Frame.Triggers>
                        <VerticalStackLayout Spacing="15">
                            <HorizontalStackLayout Spacing="10">
                                <Label Text="âœ…"
                                       FontSize="24"
                                       VerticalOptions="Center"/>
                                <Label Text="Vous possÃ©dez ce jeu"
                                       FontSize="18"
                                       FontAttributes="Bold"
                                       TextColor="#beee11"
                                       VerticalOptions="Center"/>
                            </HorizontalStackLayout>
                            
                            <Button Text="TÃ©lÃ©charger"
                                    Command="{Binding DownloadCommand}"
                                    BackgroundColor="#66c0f4"
                                    TextColor="White"
                                    FontAttributes="Bold"
                                    FontSize="16"
                                    CornerRadius="3"
                                    HeightRequest="50"/>
                        </VerticalStackLayout>
                    </Frame>

                </VerticalStackLayout>
            </VerticalStackLayout>

            <!-- Empty State -->
            <VerticalStackLayout Padding="40"
                                Spacing="20"
                                VerticalOptions="Center"
                                IsVisible="{Binding Game, Converter={StaticResource IsNullConverter}}"
                                Margin="0,100,0,0">
                <Label Text="ðŸŽ®"
                       FontSize="80"
                       HorizontalOptions="Center"
                       TextColor="#66c0f4"/>
                <Label Text="Aucun jeu sÃ©lectionnÃ©"
                       FontSize="20"
                       FontAttributes="Bold"
                       TextColor="#c7d5e0"
                       HorizontalOptions="Center"/>
            </VerticalStackLayout>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>